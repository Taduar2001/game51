var PlayerMovement=pc.createScript("playerMovement");PlayerMovement.attributes.add("speed",{type:"number",default:5}),PlayerMovement.attributes.add("smoothTime",{type:"number",default:.1}),PlayerMovement.attributes.add("minX",{type:"number",default:-1}),PlayerMovement.attributes.add("maxX",{type:"number",default:1}),PlayerMovement.attributes.add("leftCollider",{type:"entity"}),PlayerMovement.attributes.add("rightCollider",{type:"entity"}),PlayerMovement.attributes.add("puckPowLeft",{type:"entity"}),PlayerMovement.attributes.add("puckPowRight",{type:"entity"}),PlayerMovement.attributes.add("idleLeft",{type:"asset"}),PlayerMovement.attributes.add("idleRight",{type:"asset"}),PlayerMovement.attributes.add("happyLeft",{type:"asset"}),PlayerMovement.attributes.add("happyRight",{type:"asset"}),PlayerMovement.attributes.add("sadLeft",{type:"asset"}),PlayerMovement.attributes.add("sadRight",{type:"asset"}),PlayerMovement.attributes.add("scrollBar",{type:"entity",default:null}),PlayerMovement.attributes.add("threshold",{type:"number",default:.01,description:"Минимальное изменение ScrollBar для поворота персонажа"}),PlayerMovement.attributes.add("movementSpeed",{type:"number",default:5,description:"Скорость отклика движения персонажа"}),PlayerMovement.prototype.initialize=function(){this.mood=0,this.targetPositionX=this.entity.getPosition().x,this.sprite=this.entity.sprite,this.sprite.sprite=this.idleLeft.resource,this.timeLimit=.5,this.timeLimitLose=2,this.timer=0,this.isRunning=!1,this.usingScrollBar=!!this.scrollBar,this.usingScrollBar&&(this.previousScrollValue=this.scrollBar.scrollbar.value),this.updateColliders(),this.updateSprite()},PlayerMovement.prototype.update=function(t){this.usingScrollBar?this.updateWithScrollBar(t):this.updateWithKeyboard(t),1===this.mood||2===this.mood?(this.isRunning||this.startTimer(),this.isRunning&&(this.timer+=t,2===this.mood?this.timer>=this.timeLimitLose&&this.onTimerComplete():this.timer>=this.timeLimit&&this.onTimerComplete())):this.stopTimer()},PlayerMovement.prototype.updateWithScrollBar=function(t){var e=this.scrollBar.scrollbar.value,i=pc.math.lerp(this.minX,this.maxX,e);this.targetPositionX=i;var s=this.entity.getPosition(),r=pc.math.lerp(s.x,this.targetPositionX,t*this.movementSpeed);this.entity.setPosition(r,s.y,s.z);var a=e-this.previousScrollValue;Math.abs(a)>this.threshold&&(a>0?(this.leftCollider.enabled=!1,this.rightCollider.enabled=!0):(this.leftCollider.enabled=!0,this.rightCollider.enabled=!1)),this.updateSprite(),this.previousScrollValue=e},PlayerMovement.prototype.updateWithKeyboard=function(t){var e=0;(this.app.keyboard.isPressed(pc.KEY_A)||this.app.keyboard.isPressed(pc.KEY_LEFT))&&(e=-1),(this.app.keyboard.isPressed(pc.KEY_D)||this.app.keyboard.isPressed(pc.KEY_RIGHT))&&(e=1),this.targetPositionX+=e*this.speed*t,this.targetPositionX=pc.math.clamp(this.targetPositionX,this.minX,this.maxX);var i=this.entity.getPosition(),s=pc.math.lerp(i.x,this.targetPositionX,this.smoothTime);this.entity.setPosition(s,i.y,i.z),e<0?(this.leftCollider.enabled=!0,this.rightCollider.enabled=!1):e>0&&(this.leftCollider.enabled=!1,this.rightCollider.enabled=!0),this.updateSprite()},PlayerMovement.prototype.startTimer=function(){this.isRunning=!0,this.timer=0},PlayerMovement.prototype.stopTimer=function(){this.isRunning=!1},PlayerMovement.prototype.onTimerComplete=function(){this.mood=0,this.updateSprite(),this.stopTimer()},PlayerMovement.prototype.updateSprite=function(){if(this.leftCollider.enabled)switch(this.mood){case 0:this.setSprite(this.idleLeft);break;case 1:this.setSprite(this.happyLeft);break;case 2:this.setSprite(this.sadLeft)}else switch(this.mood){case 0:this.setSprite(this.idleRight);break;case 1:this.setSprite(this.happyRight);break;case 2:this.setSprite(this.sadRight)}},PlayerMovement.prototype.setSprite=function(t){this.sprite.sprite=t.resource},PlayerMovement.prototype.updateColliders=function(){this.leftCollider&&(this.leftCollider.enabled=!0),this.rightCollider&&(this.rightCollider.enabled=!1)};var FallingObject=pc.createScript("fallingObject");FallingObject.attributes.add("fallSpeed",{type:"number",default:2,description:"Начальная скорость падения"}),FallingObject.attributes.add("maxSpeed",{type:"number",default:10,description:"Максимальная скорость падения"}),FallingObject.attributes.add("speedIncreaseRate",{type:"number",default:.1,description:"Скорость увеличения падения за секунду"}),FallingObject.attributes.add("arcHeight",{type:"number",default:2,description:"Высота дуги"}),FallingObject.attributes.add("duration",{type:"number",default:2,description:"Время перемещения"}),FallingObject.attributes.add("targetLeft",{type:"entity"}),FallingObject.attributes.add("targetRight",{type:"entity"}),FallingObject.attributes.add("objectSpawner",{type:"entity"}),FallingObject.attributes.add("player",{type:"entity"}),FallingObject.attributes.add("pow",{type:"entity"}),FallingObject.attributes.add("score",{type:"entity"}),FallingObject.attributes.add("pool",{type:"entity"}),FallingObject.attributes.add("stickPow",{type:"entity"}),FallingObject.attributes.add("settings",{type:"entity"}),FallingObject.attributes.add("offset",{type:"vec3",default:[0,0,0],description:"Смещение относительно целевого объекта"}),FallingObject.attributes.add("isRed",{type:"boolean"}),FallingObject.prototype.initialize=function(){this.isFalling=!0,this.isMoving=!1,this.elapsedTime=0,this.startPosition=null,this.target=null,this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},FallingObject.prototype.update=function(t){this.isFalling&&this.entity.translateLocal(0,-this.settings.script.settings.currentFallSpeed*t,0)},FallingObject.prototype.onTriggerEnter=function(t){if(this.isFalling){if(this.isFalling=!1,t.tags.has("left"))this.objectSpawner.script.objectSpawner.stickSound.sound.play("Stick"),this.isRed?this.objectSpawner.script.objectSpawner.heartSystem.script.heartSystemWithAnimation.enableNext():(this.objectSpawner.script.objectSpawner.scoreSystem.script.scoreSystem.addScore(100),this.score.setPosition(this.entity.getPosition().add(this.offset)),this.score.script.opacityScale.start()),this.shot(),this.luckyShot(1),this.entity.script.moveArc.target=this.targetLeft;else{if(!t.tags.has("right"))return this.isRed||(this.objectSpawner.script.objectSpawner.stickSound.sound.play("Lose"),this.objectSpawner.script.objectSpawner.heartSystem.script.heartSystemWithAnimation.disableNext()),this.pow.setPosition(this.entity.getPosition()),this.pow.script.scaleAnimation.startAnim(),this.luckyShot(2),void this.entity.script.scaleToZero.startScaling(1);this.objectSpawner.script.objectSpawner.stickSound.sound.play("Stick"),this.isRed?this.objectSpawner.script.objectSpawner.heartSystem.script.heartSystemWithAnimation.enableNext():(this.objectSpawner.script.objectSpawner.scoreSystem.script.scoreSystem.addScore(100),this.score.setPosition(this.entity.getPosition().add(this.offset)),this.score.script.opacityScale.start()),this.shot(),this.luckyShot(1),this.entity.script.moveArc.target=this.targetRight}this.entity.script.moveArc.start()}},FallingObject.prototype.shot=function(){this.stickPow.setPosition(this.entity.getPosition()),this.player.script.scaleAnimation.startAnim()},FallingObject.prototype.luckyShot=function(t){this.player.script.playerMovement.mood=t,this.player.script.playerMovement.updateSprite()};var ScaleToZero=pc.createScript("scaleToZero");ScaleToZero.attributes.add("scaleSpeed",{type:"number",default:1}),ScaleToZero.prototype.initialize=function(){this.isScaling=!1,this.startScale=null,this.targetScale=new pc.Vec3(0,0,0),this.elapsedTime=0},ScaleToZero.prototype.startScaling=function(e){this.startScale=this.entity.getLocalScale().clone(),this.scaleSpeed=e||1,this.elapsedTime=0,this.isScaling=!0},ScaleToZero.prototype.update=function(e){if(this.isScaling){this.elapsedTime+=e;var t=Math.min(this.elapsedTime/this.scaleSpeed,1),i=new pc.Vec3;i.lerp(this.startScale,this.targetScale,t),this.entity.setLocalScale(i),t>=1&&(this.entity.setLocalScale(this.targetScale),this.isScaling=!1,this.entity.script.fallingObject.objectSpawner.script.objectSpawner.destroyObject(this.entity))}};var ObjectSpawner=pc.createScript("objectSpawner");ObjectSpawner.attributes.add("poolBase",{type:"entity",title:"Pool Base",description:"Entity Pool for Base objects"}),ObjectSpawner.attributes.add("poolBet",{type:"entity",title:"Pool Bet",description:"Entity Pool for Bet objects"}),ObjectSpawner.attributes.add("targetLeft",{type:"entity",title:"Target Left"}),ObjectSpawner.attributes.add("targetRight",{type:"entity",title:"Target Right"}),ObjectSpawner.attributes.add("player",{type:"entity"}),ObjectSpawner.attributes.add("score",{type:"entity"}),ObjectSpawner.attributes.add("pow",{type:"entity"}),ObjectSpawner.attributes.add("scoreSystem",{type:"entity"}),ObjectSpawner.attributes.add("heartSystem",{type:"entity"}),ObjectSpawner.attributes.add("settings",{type:"entity"}),ObjectSpawner.attributes.add("stickSound",{type:"entity"}),ObjectSpawner.attributes.add("powStick",{type:"entity"}),ObjectSpawner.attributes.add("baseProbability",{type:"number",default:70,title:"Base Probability (%)",description:"Chance to spawn a Base object (0-100)"}),ObjectSpawner.prototype.initialize=function(){this.xMin=-3,this.xMax=3,this.startY=4.5,this.spawnInterval=1,this.maxObjects=10,this.currentObjects=[],this.spawnTimer=0,this.isSpawning=!0},ObjectSpawner.prototype.update=function(t){this.isSpawning&&(this.spawnTimer+=t,this.spawnTimer>=this.spawnInterval&&(this.spawnTimer=0,this.spawnObjectIfPossible()))},ObjectSpawner.prototype.enableSpawning=function(){this.isSpawning=!0},ObjectSpawner.prototype.disableSpawning=function(){this.isSpawning=!1,this.clearCurrentObjects()},ObjectSpawner.prototype.clearCurrentObjects=function(){for(;this.currentObjects.length>0;){const t=this.currentObjects.pop();this.destroyObjectPool(t)}},ObjectSpawner.prototype.spawnObjectIfPossible=function(){if(this.currentObjects.length>=this.maxObjects)return void console.log("Limit");const t=pc.math.random(this.xMin,this.xMax),e=this.startY,i=pc.math.random(0,100)<this.baseProbability?this.poolBase:this.poolBet,s=i.script.poolSystem.getObject();if(s){const r=new pc.Vec3(t,e,2);s.setPosition(r),s.enabled=!0,s.script.fallingObject.isFalling=!0,s.setEulerAngles(0,0,0),s.script.scaleToZero.isScaling=!1,s.script&&s.script.fallingObject&&(s.script.fallingObject.targetLeft=this.targetLeft,s.script.fallingObject.targetRight=this.targetRight,s.script.fallingObject.objectSpawner=this.entity,s.script.fallingObject.player=this.player,s.script.fallingObject.pow=this.pow,s.script.fallingObject.score=this.score,s.script.fallingObject.pool=i,s.script.fallingObject.settings=this.settings,s.script.fallingObject.stickPow=this.powStick),this.currentObjects.push(s)}else console.warn("ObjectSpawner: Failed to retrieve object from pool")},ObjectSpawner.prototype.destroyObject=function(t){const e=this.currentObjects.indexOf(t);e>-1&&this.currentObjects.splice(e,1),t.script.fallingObject.pool.script.poolSystem.returnObject(t)},ObjectSpawner.prototype.destroyObjectPool=function(t){t.script.fallingObject.pool.script.poolSystem.returnObject(t)};var MoveArc=pc.createScript("moveArc");MoveArc.attributes.add("target",{type:"entity",title:"Target Entity",description:"Объект, к которому нужно двигаться"}),MoveArc.attributes.add("arcHeight",{type:"number",default:2,title:"Arc Height",description:"Высота дуги"}),MoveArc.attributes.add("duration",{type:"number",default:2,title:"Duration",description:"Время перемещения (в секундах)"}),MoveArc.attributes.add("rotationAngle",{type:"number",default:360,title:"Rotation Angle",description:"Угол вращения по Z (в градусах)"}),MoveArc.prototype.initialize=function(){this.timer=0,this.isMoving=!1,this.startPosition=null,this.startRotation=null},MoveArc.prototype.update=function(t){if(!this.isMoving||!this.target)return;this.timer+=t;let i=this.timer/this.duration;i>=1&&(i=1,this.isMoving=!1,this.entity.script.fallingObject.objectSpawner.script.objectSpawner.destroyObject(this.entity));const e=this.target.getPosition(),r=this.lerpArc(this.startPosition,e,i,this.arcHeight);this.entity.setPosition(r.x,r.y,this.startPosition.z);const o=pc.math.lerp(0,this.rotationAngle,i);this.entity.setEulerAngles(0,0,o)},MoveArc.prototype.lerpArc=function(t,i,e,r){const o=pc.math.lerp(t.x,i.x,e),s=(pc.math.lerp(t.y,i.y,e),(t.y+i.y)/2+r),n=pc.math.lerp(pc.math.lerp(t.y,s,e),pc.math.lerp(s,i.y,e),e);return new pc.Vec3(o,n,0)},MoveArc.prototype.start=function(){this.target?(this.timer=0,this.startPosition=this.entity.getPosition().clone(),this.startRotation=this.entity.getEulerAngles().clone(),this.isMoving=!0):console.error("Target entity is not assigned!")};var AdjustCameraOrthoSize=pc.createScript("adjustCameraOrthoSize");AdjustCameraOrthoSize.attributes.add("camera",{type:"entity"}),AdjustCameraOrthoSize.attributes.add("refResolution",{type:"vec2",default:[1920,1080],title:"Reference Resolution",description:"Базовое разрешение экрана"}),AdjustCameraOrthoSize.attributes.add("refOrthoSize",{type:"number",default:5,title:"Reference Ortho Size",description:"Ортографический размер для базового разрешения"}),AdjustCameraOrthoSize.prototype.initialize=function(){this.updateOrthoSize(),this.app.graphicsDevice.on("resizecanvas",this.updateOrthoSize,this)},AdjustCameraOrthoSize.prototype.destroy=function(){this.app.graphicsDevice.off("resizecanvas",this.updateOrthoSize,this)},AdjustCameraOrthoSize.prototype.updateOrthoSize=function(){var e=this.refResolution.x/this.refResolution.y,t=this.app.graphicsDevice.width/this.app.graphicsDevice.height;if(t>e)this.camera.camera.orthoHeight=this.refOrthoSize;else{var i=this.refOrthoSize*(e/t);this.camera.camera.orthoHeight=i}};var ScaleRectByScreenWidth=pc.createScript("scaleRectByScreenWidth");ScaleRectByScreenWidth.attributes.add("scaleFactor",{type:"number",default:1,title:"Scale Factor",description:"Коэффициент масштабирования (от 0 до 1)"}),ScaleRectByScreenWidth.attributes.add("refResolution",{type:"vec2",default:[1920,1080],title:"Reference Resolution",description:"Базовое разрешение экрана"}),ScaleRectByScreenWidth.attributes.add("targetRects",{type:"entity",array:!0,title:"Target Rects",description:"Список целевых объектов для масштабирования"}),ScaleRectByScreenWidth.prototype.initialize=function(){this.initScales=[];for(var e=0;e<this.targetRects.length;e++){var t=this.targetRects[e];t&&(this.initScales[e]=t.getLocalScale().clone())}this.updateScale(),this.app.graphicsDevice.on("resizecanvas",this.updateScale,this)},ScaleRectByScreenWidth.prototype.destroy=function(){this.app.graphicsDevice.off("resizecanvas",this.updateScale,this)},ScaleRectByScreenWidth.prototype.updateScale=function(){var e=this.refResolution.x/this.refResolution.y,t=this.app.graphicsDevice.width/this.app.graphicsDevice.height;if(t<e)for(var i=pc.math.lerp(1,t/e,this.scaleFactor),c=0;c<this.targetRects.length;c++){var a=this.targetRects[c];if(a){var r=this.initScales[c];a.setLocalScale(r.x*i,r.y*i,r.z)}}};var PoolSystem=pc.createScript("poolSystem");PoolSystem.attributes.add("assetType",{type:"asset",assetType:"template",title:"Asset Template"}),PoolSystem.attributes.add("scale",{type:"vec3",title:"Scale",default:[1,1,1]}),PoolSystem.prototype.initialize=function(){this.pool=[],this.assetType||console.error("Pool: Asset Template is not set!")},PoolSystem.prototype.getObject=function(){if(this.pool.length>0){var t=this.pool.shift();return t.setLocalScale(this.scale),t}return this.createObject()},PoolSystem.prototype.returnObject=function(t){t.enabled=!1,this.pool.push(t)},PoolSystem.prototype.createObject=function(){if(!this.assetType)return console.error("Pool: Asset Template is not set!"),null;var t=this.assetType.resource.instantiate();return this.app.root.addChild(t),t.setLocalScale(this.scale),t};var PlayerPow=pc.createScript("playerPow");PlayerPow.prototype.initialize=function(){},PlayerPow.prototype.update=function(e){};var ScaleAnimation=pc.createScript("scaleAnimation");ScaleAnimation.attributes.add("targetEntity",{type:"entity",description:"Объект, к которому будет применяться анимация"}),ScaleAnimation.attributes.add("targetScale",{type:"vec3",default:[1,1,1],description:"Целевой скейл объекта"}),ScaleAnimation.attributes.add("additionalScale",{type:"vec3",default:[.5,.5,.5],description:"Дополнительный скейл, добавляемый к целевому скейлу"}),ScaleAnimation.attributes.add("durationUp",{type:"number",default:1,description:"Длительность увеличения/уменьшения в секундах"}),ScaleAnimation.attributes.add("durationDown",{type:"number",default:1,description:"Длительность увеличения/уменьшения в секундах"}),ScaleAnimation.prototype.startAnim=function(){this.startScale={x:0,y:0,z:0},this.targetEntity?this.animateScale():console.error("ScaleAnimation: targetEntity не указан.")},ScaleAnimation.prototype.animateScale=function(){this.targetEntity.setLocalScale(this.startScale.x,this.startScale.y,this.startScale.z),this.targetEntity.tween(this.targetEntity.getLocalScale()).to({x:this.targetScale.x+this.additionalScale.x,y:this.targetScale.y+this.additionalScale.y,z:this.targetScale.z+this.additionalScale.z},this.durationUp,pc.Liner).onComplete((()=>{this.targetEntity.tween(this.targetEntity.getLocalScale()).to(this.startScale,this.durationDown,pc.Liner).start()})).start()};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},onUpdate:function(t){return this.on("update",t),this},onComplete:function(t){return this.on("complete",t),this},onLoop:function(t){return this.on("loop",t),this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var OpacityScale=pc.createScript("opacityScale");OpacityScale.attributes.add("targetEntity",{type:"entity",description:"Объект, к которому будет применяться анимация"}),OpacityScale.attributes.add("targetText",{type:"entity"}),OpacityScale.attributes.add("targetScale",{type:"vec3",default:[1,1,1],description:"Целевой скейл объекта"}),OpacityScale.attributes.add("durationScale",{type:"number",default:1,description:"Длительность увеличения скейла в секундах"}),OpacityScale.attributes.add("durationFade",{type:"number",default:1,description:"Длительность изменения прозрачности в секундах"}),OpacityScale.prototype.start=function(){this.startScale={x:0,y:0,z:0},this.startOpacity=1,this.targetEntity&&(this.spriteComponent=this.targetEntity.element,this.animate())},OpacityScale.prototype.animate=function(){this.targetEntity.setLocalScale(this.startScale.x,this.startScale.y,this.startScale.z),this.spriteComponent.opacity=this.startOpacity,this.targetText.element.opacity=this.startOpacity,this.targetEntity.tween(this.targetEntity.getLocalScale()).to({x:this.targetScale.x,y:this.targetScale.y,z:this.targetScale.z},this.durationScale,pc.Liner).onComplete((()=>{this.targetEntity.tween(this.spriteComponent).to({opacity:0},this.durationFade,pc.Liner).start(),this.targetEntity.tween(this.targetText.element).to({opacity:0},this.durationFade,pc.Liner).start()})).start()};var ScoreSystem=pc.createScript("scoreSystem");ScoreSystem.attributes.add("textElement",{type:"entity",title:"Text Element",description:"Entity with a Text Element component to display the score"}),ScoreSystem.attributes.add("animationSpeed",{type:"number",default:50,title:"Animation Speed",description:"Speed at which the score increases toward the target"}),ScoreSystem.prototype.initialize=function(){this.score=0,this.targetScore=0,this.textElement&&this.textElement.element?this.updateScoreText():console.warn("Text Element не указан или отсутствует компонент element.")},ScoreSystem.prototype.addScore=function(e){this.targetScore+=e},ScoreSystem.prototype.resetScore=function(){this.score=0,this.targetScore=0,this.updateScoreText(),console.log("Score has been reset.")},ScoreSystem.prototype.updateScoreText=function(){this.textElement&&this.textElement.element&&(this.textElement.element.text=Math.floor(this.score))},ScoreSystem.prototype.update=function(e){this.score<this.targetScore&&(this.score+=this.animationSpeed*e,this.targetScore-this.score<.1&&(this.score=this.targetScore),this.updateScoreText())};var HeartSystemWithAnimation=pc.createScript("heartSystemWithAnimation");HeartSystemWithAnimation.attributes.add("gameManager",{type:"entity"}),HeartSystemWithAnimation.attributes.add("nameScene",{type:"string"}),HeartSystemWithAnimation.attributes.add("objects",{type:"entity",array:!0,title:"Objects"}),HeartSystemWithAnimation.attributes.add("objectsFull",{type:"entity",array:!0}),HeartSystemWithAnimation.attributes.add("objectsDop",{type:"entity",array:!0}),HeartSystemWithAnimation.attributes.add("targetScale",{type:"vec3",default:[1,1,1],description:"Целевой скейл объекта"}),HeartSystemWithAnimation.attributes.add("additionalScale",{type:"vec3",default:[.5,.5,.5],description:"Дополнительный скейл, добавляемый к целевому скейлу"}),HeartSystemWithAnimation.attributes.add("durationUp",{type:"number",default:1,description:"Длительность увеличения до целевого масштаба"}),HeartSystemWithAnimation.attributes.add("durationDown",{type:"number",default:1,description:"Длительность уменьшения до нуля"}),HeartSystemWithAnimation.attributes.add("durationScaleZero",{type:"number",default:.5,description:"Длительность уменьшения до нуля"}),HeartSystemWithAnimation.prototype.initialize=function(){this.disabledObjects=[]},HeartSystemWithAnimation.prototype.disableNext=function(){this.gameManager.script.gameManager.fail();for(var t=0;t<this.objects.length;t++){if(!this.objects[this.objects.length-2].enabled)return void this.allObjectsDisabled();if(this.objects[t].enabled){const e=this.objects[t];return void this.animateScaleDown(e,(()=>{e.enabled=!1,this.disabledObjects.push(e)}))}}},HeartSystemWithAnimation.prototype.enableNext=function(){var t;this.disabledObjects.length>0?((t=this.disabledObjects.pop()).enabled=!0,this.animateScaleUp(t)):this.objectsFull.length>0&&((t=this.objectsFull.pop()).enabled=!0,this.objects.push(this.objectsDop.pop()),this.animateScaleUp(t))},HeartSystemWithAnimation.prototype.animateScaleDown=function(t,e){t.tween(t.getLocalScale()).to({x:0,y:0,z:0},this.durationScaleZero,pc.Linear).onComplete(e).start()},HeartSystemWithAnimation.prototype.animateScaleUp=function(t){t.setLocalScale(0,0,0),t.tween(t.getLocalScale()).to({x:this.targetScale.x+this.additionalScale.x,y:this.targetScale.y+this.additionalScale.y,z:this.targetScale.z+this.additionalScale.z},this.durationUp,pc.Linear).onComplete((()=>{t.tween(t.getLocalScale()).to({x:this.targetScale.x,y:this.targetScale.y,z:this.targetScale.z},this.durationDown,pc.Linear).start()})).start()},HeartSystemWithAnimation.prototype.allObjectsDisabled=function(){this.app.scenes.changeScene(this.nameScene),console.log(this.gameManager.script.gameManager.maxScore)};var GameManager=pc.createScript("gameManager");GameManager.attributes.add("objectSpawner",{type:"entity"}),GameManager.attributes.add("score",{type:"entity"}),GameManager.attributes.add("settings",{type:"entity"}),GameManager.prototype.initialize=function(){this.maxScore=0},GameManager.prototype.fail=function(){this.score.script.scoreSystem.targetScore>this.maxScore&&(this.maxScore=this.score.script.scoreSystem.targetScore),this.settings.script.settings.reset(),this.score.script.scoreSystem.resetScore(),this.objectSpawner.script.objectSpawner.disableSpawning(),this.objectSpawner.script.objectSpawner.enableSpawning()};var Settings=pc.createScript("settings");Settings.attributes.add("fallSpeed",{type:"number",default:2,description:"Начальная скорость падения"}),Settings.attributes.add("maxSpeed",{type:"number",default:10,description:"Максимальная скорость падения"}),Settings.attributes.add("speedIncreaseRate",{type:"number",default:.1,description:"Коэффициент увеличения скорости"}),Settings.prototype.initialize=function(){window.focus(),this.currentFallSpeed=this.fallSpeed,this.timeElapsed=0},Settings.prototype.update=function(e){this.timeElapsed+=e;let t=1-Math.exp(-this.speedIncreaseRate*this.timeElapsed/5);this.currentFallSpeed=Math.min(this.fallSpeed+(this.maxSpeed-this.fallSpeed)*t,this.maxSpeed)},Settings.prototype.reset=function(){this.currentFallSpeed=this.fallSpeed,this.timeElapsed=0};var ScrollBarToCharacter=pc.createScript("scrollBarToCharacter");ScrollBarToCharacter.attributes.add("scrollBar",{type:"entity",description:"Ссылка на Scrollbar"}),ScrollBarToCharacter.attributes.add("character",{type:"entity",description:"Ссылка на объект персонажа"}),ScrollBarToCharacter.attributes.add("threshold",{type:"number",default:.01,description:"Минимальное изменение ScrollBar для поворота персонажа"}),ScrollBarToCharacter.attributes.add("movementSpeed",{type:"number",default:5,description:"Скорость отклика движения персонажа"}),ScrollBarToCharacter.prototype.initialize=function(){this.scrollBar&&this.character?(this.previousScrollValue=this.scrollBar.scrollbar.value,this.targetPositionX=pc.math.lerp(-2,2,this.previousScrollValue)):console.error("Не указаны Scrollbar или персонаж!")},ScrollBarToCharacter.prototype.update=function(r){var t=this.scrollBar.scrollbar.value;this.targetPositionX=pc.math.lerp(-2,2,t);var a=this.character.getPosition(),e=pc.math.lerp(a.x,this.targetPositionX,r*this.movementSpeed);this.character.setLocalPosition(e,a.y,a.z);var l=t-this.previousScrollValue;Math.abs(l)>this.threshold&&(l>0?this.character.setLocalEulerAngles(0,0,0):this.character.setLocalEulerAngles(0,180,0)),this.previousScrollValue=t};var Loader=pc.createScript("loader");Loader.prototype.initialize=function(){this.isMobile()?this.loadScene("GameScene_Desktop"):this.loadScene("GameScene_Mobile")},Loader.prototype.isMobile=function(){return!pc.platform.mobile},Loader.prototype.loadScene=function(e){this.app.scenes.changeScene(e)};pc.script.createLoadingScreen((function(t){var e,o;e=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #283538;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #f60;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(o=document.createElement("style")).type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e)),document.head.appendChild(o),t.on("preload:end",(function(){t.off("preload:progress")}))}));var PulseScale=pc.createScript("pulseScale");PulseScale.attributes.add("targetEntity",{type:"entity",description:"Объект, к которому будет применяться анимация"}),PulseScale.attributes.add("targetScale",{type:"vec3",default:[1,1,1],description:"Целевой скейл объекта"}),PulseScale.attributes.add("additionalScale",{type:"vec3",default:[.5,.5,.5],description:"Дополнительный скейл, добавляемый к целевому скейлу"}),PulseScale.attributes.add("duration",{type:"number",default:1,description:"Длительность одного цикла увеличения/уменьшения в секундах"}),PulseScale.prototype.initialize=function(){this.targetEntity?this.startPulse():console.error("ScaleAnimation: targetEntity не указан.")},PulseScale.prototype.startPulse=function(){this.targetEntity.tween(this.targetEntity.getLocalScale()).to({x:this.targetScale.x+this.additionalScale.x,y:this.targetScale.y+this.additionalScale.y,z:this.targetScale.z+this.additionalScale.z},this.duration,pc.SineInOut).yoyo(!0).repeat(1/0).start()};var DisableObjects=pc.createScript("disableObjects");DisableObjects.attributes.add("button",{type:"entity",title:"Button",description:"Кнопка, которая будет отключать объекты"}),DisableObjects.attributes.add("objectsToDisable",{type:"entity",array:!0,title:"Objects to Disable",description:"Массив объектов, которые нужно отключить"}),DisableObjects.prototype.initialize=function(){this.button&&this.button.element?this.button.element.on("mousedown",this.onButtonPress,this):console.warn("Кнопка не указана или у неё отсутствует компонент Element.")},DisableObjects.prototype.onButtonPress=function(){for(var t=0;t<this.objectsToDisable.length;t++)this.objectsToDisable[t]&&(this.objectsToDisable[t].enabled=!1)};var FakeClick=pc.createScript("fakeClick");FakeClick.prototype.initialize=function(){this.entity.element.fire("click")},FakeClick.prototype.update=function(e){};